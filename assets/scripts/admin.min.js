"use strict";function ownKeys(t,e){var r,i=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)),i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(n){function e(e){return 0<e.length}var t={},r=(n(window),n(document)),i=n(".selectbox-wraper select"),a=n(".fields-wrapper.image-upload"),o=n(".image-gallery"),l=n(".field-colorpicker"),c=n(".conditional-field");t.wpColorPicker=function(){e(l)&&l.wpColorPicker()},t.select2=function(){e(i)&&i.each(function(){var e=n(this).parent(".selectbox-wraper").data("multiselect"),t={multiple:!1};Boolean(e)&&(t.multiple=!0);var r=n(this).select2(_objectSpread({},t));Boolean(e)&&r.next().children().children().children().sortable({containment:"parent",stop:function(e,t){t.item.parent().children("[title]").each(function(){var e=n(this).attr("title"),e=n("option:contains("+e+")",r).first();e.detach(),r.append(e)}),r.change()}})})},t.imageUpload=function(){e(a)&&(a.on("click",".upload-btn",function(e){e.preventDefault();var t=e.target.closest(".field-wrapper"),r=t.querySelector(".preview-image"),i=t.querySelector(".image_input_field"),n=wp.media({title:"Insert image",library:{type:"image"},button:{text:"Use this image"},multiple:!1});n.on("open",function(){var e=i.value.split(","),t=n.state().get("selection");e.forEach(function(e){e=wp.media.attachment(e);e.fetch(),t.add(e?[e]:[])})}),n.on("select",function(){var e=n.state().get("selection").first().toJSON();r.style.backgroundImage="url("+e.url+")",i.value=e.id,t.querySelector(".preview-wrap").classList.remove("button-hide")}),n.open()}),a.on("click",".metabox-image-remove",function(e){e.preventDefault();var t=e.target.closest(".field-wrapper"),e=t.querySelector(".preview-image");t.querySelector(".image_input_field").value="",e.style.backgroundImage="url(https://via.placeholder.com/700x200)",t.querySelector(".preview-wrap").classList.add("button-hide")}))},t.galleryImage=function(){e(o)&&(o.on("click",".upload-btn",function(e){e.preventDefault();var e=e.target.closest(".field-wrapper"),i=e.querySelector(".preview-list"),n=e.querySelector(".image_input_field"),a=wp.media({title:"Insert image",library:{type:"image"},button:{text:"Use this image"},multiple:"add"});a.on("open",function(){var e=n.value.split(","),t=a.state().get("selection");e.forEach(function(e){e=wp.media.attachment(e);e.fetch(),t.add(e?[e]:[])})}),a.on("select",function(){var e=a.state().get("selection").toJSON(),t="",r=[];e.forEach(function(e){e.id&&(t+='<li class="preview-wrap" data-id='+e.id+'><div class="preview-image" style="background-image:url('+e.url+')"></div> <button class="metabox-image-remove"><span class="dashicons dashicons-no-alt"></span></button><a href="#" class="metabox-image-edit" target="_blank"> <span class="dashicons dashicons-edit-large"></span> </a> </li>',r.push(e.id))}),i.innerHTML=t;e=r.filter(function(e){return 0!=e});n.value=e}),a.open()}),o.on("click",".metabox-image-remove",function(e){e.preventDefault();var t=e.target.closest(".preview-wrap"),r=e.target.closest(".field-wrapper").querySelector(".image_input_field"),i=t.getAttribute("data-id"),e=(e=r.value.split(",")).filter(function(e){return e!==i});t.remove(),r.value=String(e)}),o.find("ul.preview-list").sortable({opacity:.8,stop:function(e){var t=e.target.closest(".field-wrapper").querySelector(".image_input_field"),r=[];Array.from(e.target.children).forEach(function(e){r.push(e.getAttribute("data-id"))});e=r.filter(function(e){return 0!=e});console.log(e),t.value=String(e)}}))},t.checkBox=function(){var r=n(".fields-wrapper").find("[type=checkbox]");e(r)&&r.each(function(e,t){n(t).val();n(t).on("change",function(){var e=n(r).val();e&&1==e?n(t).val(0):e&&0==e&&n(t).val(1)})})},t.conditionalField=function(){e(c)&&c.each(function(e,t){var t=n(t),r=t.attr("data-required-value"),i=(i="#"+t.attr("data-required-field")).replace("field-","");n(i).on("change",function(){console.log("====");var e=n(i).val();r==e?console.log("required"):console.log("not required")})})},r.on("ready",function(){t.wpColorPicker(),t.select2(),t.imageUpload(),t.galleryImage(),t.checkBox(),t.conditionalField()})}(jQuery);